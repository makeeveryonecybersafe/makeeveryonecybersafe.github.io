<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MECS | Digital Mirror</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* --- 1. CORE VARIABLES & RESET --- */
    * { box-sizing: border-box; }
    
    :root {
      --bg-color: #000000;
      --surface-color: #0a0a0a;
      --text-main: #e0e0e0;
      --primary: #FF0055; /* MECS PINK */
      --primary-dim: rgba(255, 0, 85, 0.1);
      --alert-red: #ff3333;
      --grid-color: #151515;
    }

    body {
      background-color: var(--bg-color);
      /* Cyber Grid Background Pattern */
      background-image: linear-gradient(var(--grid-color) 1px, transparent 1px),
      linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
      background-size: 40px 40px;
      color: var(--text-main);
      font-family: 'Space Grotesk', sans-serif;
      margin: 0;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* CRT Scanline Effect (Pink Tinted) */
    body::after {
        content: " ";
        display: block;
        position: absolute;
        top: 0; left: 0; bottom: 0; right: 0;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                    linear-gradient(90deg, rgba(255, 0, 85, 0.03), rgba(0, 0, 0, 0.02), rgba(0, 0, 255, 0.03));
        z-index: 1000;
        background-size: 100% 2px, 3px 100%;
        pointer-events: none;
    }

    /* --- HEADER (Simplified for Immersion) --- */
    .header-mini {
        position: absolute; top: 0; left: 0; width: 100%;
        padding: 1.5rem; display: flex; justify-content: space-between;
        z-index: 50; pointer-events: none; /* Let clicks pass through */
    }
    .logo {
        font-weight: 900; color: #fff; text-transform: uppercase; letter-spacing: -1px; pointer-events: auto; cursor: pointer;
    }

    #app-container {
        width: 90%; max-width: 600px;
        text-align: center; z-index: 10;
        position: relative;
    }

    h1 {
        font-size: clamp(2.5rem, 6vw, 4rem);
        font-weight: 900; letter-spacing: -2px;
        text-transform: uppercase; margin-bottom: 2rem;
        line-height: 1; text-shadow: 0 0 20px rgba(255, 0, 85, 0.3);
    }
    
    /* MECS Button Style */
    .btn {
        background: var(--primary);
        color: #000;
        border: none;
        padding: 1rem 3rem;
        font-size: 1rem;
        font-family: 'Space Grotesk', sans-serif;
        font-weight: 800;
        text-transform: uppercase;
        cursor: pointer;
        transition: 0.2s;
        /* The Polygon Clip */
        clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
    }
    .btn:hover {
        transform: translate(-2px, -2px);
        box-shadow: 4px 4px 0 #fff;
    }

    /* Utility Classes */
    .hidden { display: none !important; }
    .text-primary { color: var(--primary); text-shadow: 0 0 10px var(--primary); }
    .text-red { color: var(--alert-red); text-shadow: 0 0 10px red; }
    .mono { font-family: 'JetBrains Mono', monospace; }

    /* Quiz Styles */
    .quiz-card {
        background: rgba(10, 10, 10, 0.8);
        border: 1px solid #333;
        backdrop-filter: blur(10px);
        padding: 2rem;
        position: relative;
    }
    .quiz-card::before {
        content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: var(--primary);
    }

    .quiz-btn {
        display: block; width: 100%; margin: 15px 0;
        background: transparent;
        border: 1px solid #444;
        color: #fff;
        padding: 1rem;
        font-family: 'Space Grotesk', sans-serif;
        font-weight: 700;
        text-transform: uppercase;
        cursor: pointer;
        transition: 0.2s;
    }
    .quiz-btn:hover {
        border-color: var(--primary);
        color: var(--primary);
        background: var(--primary-dim);
    }

    /* Analysis Text Lines */
    .analysis-line {
        margin: 15px 0; font-size: 1.1rem; opacity: 0; transition: opacity 0.5s ease-in;
        font-family: 'JetBrains Mono', monospace;
        border-left: 2px solid var(--primary);
        padding-left: 1rem;
        text-align: left;
        background: linear-gradient(90deg, rgba(255,0,85,0.05) 0%, transparent 100%);
    }

    /* Transition Phase */
    #transition-text h3 {
        font-size: 1.8rem; margin-bottom: 20px; font-weight: 300;
    }

    /* --- AUCTION / EASTER EGG STYLES --- */
    #auction-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: black; z-index: 5;
        display: flex; flex-direction: column;
    }

    #webcam-feed {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        object-fit: cover;
        /* MECS Style Filter: High Contrast, Desaturated, Slight Pink Tint */
        filter: grayscale(100%) contrast(1.5) brightness(0.8) sepia(0.3) hue-rotate(300deg);
        z-index: 1;
        opacity: 0.6;
    }

    .no-footage {
        background: #000;
        display: flex; align-items: center; justify-content: center;
        color: #333; font-size: 2rem; font-weight: bold;
        position: absolute; top:0; left:0; width:100%; height:100%;
        z-index: 1;
        font-family: 'JetBrains Mono', monospace;
    }

    #auction-ui {
        position: relative; z-index: 10; height: 100%;
        display: flex; flex-direction: column; justify-content: space-between;
        padding: 20px;
        background: radial-gradient(circle at center, transparent 0%, #000 90%);
    }

    #price-tag {
        align-self: center; font-size: 4rem; color: var(--primary);
        font-weight: 900; font-family: 'Space Grotesk', sans-serif;
        background: rgba(0,0,0,0.8); padding: 10px 40px;
        border-top: 2px solid var(--primary);
        border-bottom: 2px solid var(--primary);
        margin-top: 80px;
        text-shadow: 0 0 20px var(--primary);
    }

    #chat-box {
        background: rgba(0, 0, 0, 0.85);
        height: 40%;
        overflow-y: auto;
        border-top: 1px solid var(--primary);
        padding: 20px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.9rem;
        text-align: left;
    }
    
    /* Scrollbar for chat */
    #chat-box::-webkit-scrollbar { width: 5px; }
    #chat-box::-webkit-scrollbar-track { background: #000; }
    #chat-box::-webkit-scrollbar-thumb { background: var(--primary); }

    .chat-msg { margin-bottom: 8px; line-height: 1.4; }
    .bidder { color: #888; }
    .host { color: var(--primary); font-weight: bold; }
    .bid-msg { color: #fff; border-left: 2px solid var(--primary); padding-left: 10px; }

    #sold-stamp {
        position: absolute; top: 50%; left: 50%;
        transform: translate(-50%, -50%) rotate(-15deg);
        font-size: 8rem; color: transparent; 
        -webkit-text-stroke: 4px var(--alert-red);
        padding: 20px; font-weight: 900; opacity: 0;
        pointer-events: none; z-index: 100;
        text-shadow: 0 0 30px rgba(255,0,0,0.5);
    }

    @keyframes screenOn {
        0% { transform: scaleY(0.005) scaleX(0); background: #fff; }
        50% { transform: scaleY(0.005) scaleX(1); background: #fff; }
        100% { transform: scaleY(1) scaleX(1); background: transparent; }
    }
  </style>
 </head>
 <body>

    <div class="header-mini">
        <div class="logo" onclick="window.location.href='index.html'">#MECS</div>
        <div style="font-size: 0.8rem; color: #555; font-family: 'JetBrains Mono';">PROTOCOL: MIRROR_V1</div>
    </div>

    <div id="app-container">
        
        <section id="intro">
            <h1 class="text-primary">DIGITAL<br>MIRROR</h1>
            <p style="margin-bottom: 3rem; color: #888; max-width: 400px; margin-left: auto; margin-right: auto;">
                This tool simulates how trackers analyze your digital footprint in real-time.
            </p>
            <button id="btn-begin" class="btn">INITIALIZE</button>
            <p style="margin-top:20px; font-size: 0.75rem; color:#444; font-family: 'JetBrains Mono';">
                [ HEADPHONES RECOMMENDED ]
            </p>
        </section>

        <section id="quiz" class="hidden">
            <div class="quiz-card">
                <h2 id="q-text" style="font-size: 1.5rem; margin-bottom: 2rem;">Question Text</h2>
                <div id="q-options">
                    <button class="quiz-btn" onclick="handleAnswer(true)">YES</button>
                    <button class="quiz-btn" onclick="handleAnswer(false)">NO</button>
                </div>
                <p id="q-progress" style="color: #444; margin-top: 1rem; font-family: 'JetBrains Mono';">1/15</p>
            </div>
        </section>

        <section id="analysis" class="hidden">
            <h2 class="mono" style="color: #666; font-size: 0.9rem; margin-bottom: 2rem;">/// GENERATING PROFILE ///</h2>
            <div id="analysis-content"></div>
        </section>

        <section id="transition" class="hidden">
            <div id="transition-text"></div>
        </section>

        <section id="outro" class="hidden">
            <h2 class="text-primary" style="letter-spacing: 5px;">TRANSACTION COMPLETE</h2>
            <h1 id="final-price" class="text-red" style="font-size: 5rem;">$0.00</h1>
            <h3 style="color: #666;">ESTIMATED DARK WEB VALUE</h3>
            
            <div style="max-width: 500px; margin: 3rem auto; text-align: left; color: #aaa;">
                <p>That is all you are worth to them.</p>
                <p>Your location, your habits, and your identity are traded daily for less than the price of a coffee.</p>
            </div>
            
            <div style="font-size: 0.7rem; color: #555; border: 1px solid #333; padding: 15px; margin-top: 2rem; font-family: 'JetBrains Mono'; max-width: 500px; margin: 2rem auto;">
                <strong style="color: var(--primary);">SYSTEM NOTE:</strong> No data was actually sent to a server. The device fingerprinting shown was fetched locally within your browser, exactly how trackers do it silently every day.
            </div>
            <button onclick="location.reload()" class="btn" style="margin-top: 20px; background: #333; color: #fff;">RESET SYSTEM</button>
        </section>

    </div>

    <div id="auction-overlay" class="hidden">
        <video id="webcam-feed" autoplay playsinline muted></video>
        <div class="no-footage hidden" id="no-signal">
            <div>
                <span class="text-red">âš  SIGNAL LOST</span><br>
                <span style="font-size: 1rem; color: #555;">METADATA ONLY MODE</span>
            </div>
        </div>
        <div id="sold-stamp">SOLD</div>
        <div id="auction-ui">
            <div id="price-tag">$0.00</div>
            <div id="chat-box">
                <div class="chat-msg host">SYSTEM: Establishing Secure Link...</div>
            </div>
        </div>
    </div>

    <script>
        // --- AUDIO ENGINE (Web Audio API) ---
        const SFX = {
            ctx: null,
            droneOsc: null,
            droneGain: null,

            init: function() {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },

            // Low frequency horror drone
            startDrone: function() {
                if(!this.ctx) return;
                this.droneOsc = this.ctx.createOscillator();
                this.droneGain = this.ctx.createGain();
                
                this.droneOsc.type = 'sawtooth';
                this.droneOsc.frequency.setValueAtTime(55, this.ctx.currentTime); // Low A
                
                // Add a lowpass filter
                const filter = this.ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 200;

                this.droneOsc.connect(filter);
                filter.connect(this.droneGain);
                this.droneGain.connect(this.ctx.destination);
                
                this.droneGain.gain.setValueAtTime(0.05, this.ctx.currentTime); // Quiet start
                this.droneOsc.start();
            },

            // Digital click
            click: function() {
                if(!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, this.ctx.currentTime + 0.1);
                
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.1);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.1);
            },

            // Glitch sound
            glitch: function() {
                if(!this.ctx) return;
                const bufferSize = this.ctx.sampleRate * 0.2; 
                const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }

                const noise = this.ctx.createBufferSource();
                noise.buffer = buffer;
                const gain = this.ctx.createGain();
                gain.gain.value = 0.05;
                noise.connect(gain);
                gain.connect(this.ctx.destination);
                noise.start();
            },

            // Chat beep
            chatBeep: function() {
                if(!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.3);
                
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.3);
            },

            // Slam
            slam: function() {
                if(!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.frequency.setValueAtTime(150, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 1);
                
                gain.gain.setValueAtTime(0.5, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 1);

                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 1);
            },

            // Ramp Tension
            rampTension: function() {
                if(this.droneOsc) {
                    this.droneOsc.frequency.linearRampToValueAtTime(110, this.ctx.currentTime + 10);
                    this.droneGain.gain.linearRampToValueAtTime(0.2, this.ctx.currentTime + 10);
                }
            }
        };

        // --- STATE MANAGEMENT ---
        const state = {
            camAllowed: false,
            score: 0,
            qIndex: 0,
            answers: [],
            ip: "Fetching...",
            location: "Unknown",
            device: "",
            battery: "Unknown"
        };

        const screens = {
            intro: document.getElementById('intro'),
            quiz: document.getElementById('quiz'),
            analysis: document.getElementById('analysis'),
            transition: document.getElementById('transition'),
            outro: document.getElementById('outro'),
            auction: document.getElementById('auction-overlay')
        };

        const questions = [
            { t: "Do you use the same password for multiple accounts?", insecure: true, insult: "Uses one key for every door. Easy target." },
            { t: "Do you accept cookies without reading the prompt?", insecure: true, insult: "Accepts tracking. No standards." },
            { t: "Is your date of birth public on social media?", insecure: true, insult: "DOB is public. Identity theft starter pack." },
            { t: "Do you have 2-Factor Authentication enabled?", insecure: false, insult: "No 2FA? They're practically begging for it." },
            { t: "Do you cover your webcam when not in use?", insecure: false, insult: "Lens was uncovered. Voyeur's paradise." },
            { t: "Do you click links in emails from unknown senders?", insecure: true, insult: "Clicks random links. Phishing dream." },
            { t: "Do you update your phone software immediately?", insecure: false, insult: "Running legacy software. Exploit ready." },
            { t: "Do you use free public Wi-Fi for banking?", insecure: true, insult: "Banking on Starbucks WiFi. Hilarious." },
            { t: "Do you allow apps to track your location always?", insecure: true, insult: "Location always on. I know where they sleep." },
            { t: "Do you read the Terms & Conditions?", insecure: false, insult: "Doesn't read T&C. Signed their soul away." },
            { t: "Do you post photos of your boarding passes?", insecure: true, insult: "Posts boarding passes. Barcode reveals everything." },
            { t: "Do you use a password manager?", insecure: false, insult: "No password manager. Probably uses 'Password123'." },
            { t: "Do you backup your data offline?", insecure: false, insult: "No backups. One ransomware attack and it's over." },
            { t: "Do you answer 'first pet' quizzes on social media?", insecure: true, insult: "Answers security questions for fun." },
            { t: "Do you believe you are too boring to be hacked?", insecure: true, insult: "Thinks they are 'too boring'. My favorite victim." },
        ];

        // --- PHASE 1: INTRO & PERMISSION ---
        document.getElementById('btn-begin').addEventListener('click', async () => {
            SFX.init(); 
            SFX.click();
            SFX.startDrone(); 

            // Fetch Data
            state.device = navigator.userAgent;
            try {
                const batt = await navigator.getBattery();
                state.battery = Math.round(batt.level * 100) + "%";
            } catch(e) { state.battery = "Unknown"; }
            
            try {
                const res = await fetch('https://ipapi.co/json/');
                const data = await res.json();
                state.ip = data.ip || "Hidden";
                state.location = `${data.city}, ${data.country_name}` || "Unknown";
            } catch(e) {
                state.ip = "192.168.0.XX (Trace Blocked)";
                state.location = "Triangulating...";
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                document.getElementById('webcam-feed').srcObject = stream;
                state.camAllowed = true;
                nextScreen('intro', 'quiz');
                loadQuestion();
            } catch (err) {
                state.camAllowed = false;
                document.getElementById('webcam-feed').classList.add('hidden');
                document.getElementById('no-signal').classList.remove('hidden');
                nextScreen('intro', 'quiz');
                loadQuestion();
            }
        });

        // --- PHASE 2: QUIZ ---
        function loadQuestion() {
            if (state.qIndex >= questions.length) {
                finishQuiz();
                return;
            }
            const q = questions[state.qIndex];
            document.getElementById('q-text').innerText = q.t;
            document.getElementById('q-progress').innerText = `${state.qIndex + 1}/${questions.length}`;
            SFX.glitch(); 
        }

        function handleAnswer(bool) {
            SFX.click(); 
            state.answers.push(bool);
            const q = questions[state.qIndex];
            if ((q.insecure && bool) || (!q.insecure && !bool)) {
                state.score++;
            }
            state.qIndex++;
            loadQuestion();
        }

        function nextScreen(curr, next) {
            screens[curr].classList.add('hidden');
            screens[next].classList.remove('hidden');
        }

        // --- PHASE 3: ANALYSIS ---
        function finishQuiz() {
            nextScreen('quiz', 'analysis');
            const container = document.getElementById('analysis-content');
            let lines = [];
            let scenario = ""; 

            const isSecure = state.score < 5; 
            
            if (isSecure && state.camAllowed) {
                scenario = "A";
                lines = [
                    "Analyzing behavioral patterns...",
                    "Results: <span style='color:#fff'>High Security Awareness.</span>",
                    "You spot the phishing.",
                    "But...",
                    `<span class='text-red'>You just granted camera access to a stranger.</span>`,
                    "Logic failed you."
                ];
            } else if (!isSecure) {
                scenario = "B";
                lines = [
                    "Analyzing behavioral patterns...",
                    "Results: <span class='text-red'>CRITICAL VULNERABILITY</span>",
                    "Your digital footprint is messy.",
                    "Passwords reused. Cookies accepted.",
                    "You are an open book."
                ];
            } else if (isSecure && !state.camAllowed) {
                scenario = "C";
                lines = [
                    "Analyzing behavioral patterns...",
                    "Results: <span style='color:#fff'>Secure.</span>",
                    "Camera Access: <span class='text-red'>BLOCKED</span>",
                    "You think a piece of tape saves you.",
                    "<span class='text-red'>A Blocked Lens cannot stop us.</span>",
                    `IP: <span class='text-primary'>${state.ip}</span>`,
                    `Location: <span class='text-primary'>${state.location}</span>`,
                    `Device: ${state.device.substring(0, 20)}...`
                ];
            }

            let delay = 0;
            lines.forEach((line) => {
                const p = document.createElement('div');
                p.innerHTML = line;
                p.className = 'analysis-line';
                container.appendChild(p);
                setTimeout(() => { 
                    p.style.opacity = 1; 
                    SFX.glitch(); 
                }, delay);
                delay += 1500;
            });

            setTimeout(() => { startTransition(scenario); }, delay + 2000);
        }

        // --- PHASE 4: TRANSITION ---
        function startTransition(scenario) {
            nextScreen('analysis', 'transition');
            SFX.rampTension(); 

            const container = document.getElementById('transition-text');
            let poem = [];

            if (scenario === "A") {
                poem = ["It wasn't a hack.", "It was a permission.", "Allowed by the person.", "Staring at this screen."];
            } else if (scenario === "C") {
                poem = ["It wasn't a hack.", "It was a permission.", "Allowed by the person.", "Thinking they are safe behind a blocked lens."];
            } else {
                poem = ["It wasn't a hack.", "It was the habits.", "Of the person.", "Staring at this screen."];
            }

            let delay = 0;
            poem.forEach(line => {
                const p = document.createElement('h3');
                p.innerText = line;
                p.style.opacity = 0;
                p.style.transition = "opacity 2s";
                container.appendChild(p);
                
                setTimeout(() => { p.style.opacity = 1; }, delay);
                delay += 2000;
            });

            setTimeout(() => {
                launchAuction(scenario);
            }, delay + 40000); 
        }

        // --- PHASE 5: THE AUCTION ---
        function launchAuction(scenario) {
            screens.transition.classList.add('hidden'); 
            screens.auction.classList.remove('hidden');
            screens.auction.style.animation = "screenOn 0.4s ease-out";
            SFX.click();

            const chatBox = document.getElementById('chat-box');
            const priceTag = document.getElementById('price-tag');
            let currentPrice = 0.00;
            const bidders = ["User992", "DataMines", "xX_Hunter_Xx", "Ghost", "Buyer77", "NullPtr"];
            
            let collectedInsults = [];
            state.answers.forEach((ans, idx) => {
                const q = questions[idx];
                if ((q.insecure && ans) || (!q.insecure && !ans)) {
                    collectedInsults.push(q.insult);
                }
            });
            if(collectedInsults.length === 0) {
                collectedInsults.push("Data is too clean. Suspicious.", "I bet their hard drive is gold.");
            }

            // Script Generation
            let script = [];
            
            if (state.camAllowed) {
                script.push({ role: 'bidder', text: "We have visual. Nice resolution." });
                script.push({ role: 'bidder', text: "Look at that face. They know." });
            } else {
                script.push({ role: 'bidder', text: "No cam? Boring." });
                script.push({ role: 'host', text: "Patience. The metadata is rich." });
            }

            script.push({ role: 'bidder', text: "Starting bid $0.10" });
            script.push({ role: 'bid', val: 0.10 });

            let insultIndex = 0;
            
            // Intervention 1
            script.push({ role: 'bidder', text: collectedInsults[insultIndex++] || "I want their search history." });
            script.push({ role: 'bidder', text: "Where are they?" });
            script.push({ role: 'host', text: `TRACE COMPLETE: Subject is in ${state.location}.` });
            script.push({ role: 'bidder', text: "That's local. Raising." });
            script.push({ role: 'bid', val: 0 });

            // Intervention 2
            script.push({ role: 'bidder', text: collectedInsults[insultIndex++] || "What about passwords?" });
            script.push({ role: 'bidder', text: collectedInsults[insultIndex++] || "They look nervous." });
            script.push({ role: 'bidder', text: "Raise." });
            script.push({ role: 'bid', val: 0 });

            // Intervention 3
            script.push({ role: 'bidder', text: "Is the data fresh?" });
            script.push({ role: 'host', text: `SYSTEM SCAN: ${state.device.substring(0, 25)}...` });
            script.push({ role: 'host', text: `BATTERY LEVEL: ${state.battery}. They are active.` });
            script.push({ role: 'bidder', text: "Active session? Take my money." });
            script.push({ role: 'bid', val: 0 }); 

            // Final
            script.push({ role: 'bidder', text: collectedInsults[insultIndex++] || "Gimme everything." });
            script.push({ role: 'bidder', text: "Mine." });
            script.push({ role: 'bid', val: 0 });
            script.push({ role: 'bidder', text: "All in." });
            
            script.push({ role: 'host', text: "Going once..." });
            script.push({ role: 'host', text: "Going twice..." });
            script.push({ role: 'sold' });

            let scriptIndex = 0;
            const interval = setInterval(() => {
                if (scriptIndex >= script.length) {
                    clearInterval(interval);
                    setTimeout(endSimulation, 4000);
                    return;
                }

                const item = script[scriptIndex];
                
                if (item.role === 'sold') {
                    SFX.slam(); 
                    document.getElementById('sold-stamp').style.opacity = 1;
                    document.getElementById('sold-stamp').style.transform = "translate(-50%, -50%) rotate(-15deg) scale(1.2)";
                    if(state.camAllowed) document.getElementById('webcam-feed').style.filter = "brightness(2) contrast(2)";
                } 
                else if (item.role === 'bid') {
                    SFX.click();
                    let inc = item.val > 0 ? item.val : (Math.random() * 3) + 1.5;
                    currentPrice += inc;
                    if(currentPrice > 14.8) currentPrice = 14.85; 
                    priceTag.innerText = "$" + currentPrice.toFixed(2);
                    addChat(`>>> BID RAISED TO: $${currentPrice.toFixed(2)}`, "bid-msg");
                } 
                else {
                    SFX.chatBeep(); 
                    let name = item.role === 'host' ? "HOST" : bidders[Math.floor(Math.random() * bidders.length)];
                    addChat(`${name}: ${item.text}`, item.role);
                }

                scriptIndex++;
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 2500); 
        }

        function addChat(text, type) {
            const d = document.createElement('div');
            d.className = `chat-msg ${type}`;
            d.innerText = text;
            document.getElementById('chat-box').appendChild(d);
        }

        function endSimulation() {
            if(SFX.droneOsc) SFX.droneOsc.stop(); 
            screens.auction.classList.add('hidden');
            screens.outro.classList.remove('hidden');
            document.getElementById('final-price').innerText = document.getElementById('price-tag').innerText;
        }

    </script>
 </body>
</html>
